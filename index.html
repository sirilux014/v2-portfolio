<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Travel Map: Chiang Mai to Phitsanulok | Smile Oracle</title>

    <!-- Leaflet.js CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />

    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-color: #121212;
            --panel-bg: rgba(30, 30, 30, 0.8);
            --text-color: #e0e0e0;
            --accent-color: #00e5ff;
            --accent-glow: rgba(0, 229, 255, 0.3);
            --marker-color: #ff5252;
            --line-color: #00e5ff;
        }

        body,
        html {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            overflow: hidden;
        }

        #map {
            height: 100vh;
            width: 100vw;
            background: var(--bg-color);
        }

        .header {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            background: var(--panel-bg);
            backdrop-filter: blur(10px);
            padding: 10px 25px;
            border-radius: 50px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            text-align: center;
        }

        .header h1 {
            margin: 0;
            font-size: 1.2rem;
            font-weight: 600;
            letter-spacing: 1px;
            background: linear-gradient(90deg, #fff, var(--accent-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .info-panel {
            position: absolute;
            bottom: 40px;
            right: 20px;
            z-index: 1000;
            background: var(--panel-bg);
            backdrop-filter: blur(10px);
            padding: 15px;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            font-size: 0.85rem;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .footer {
            position: absolute;
            bottom: 10px;
            left: 10px;
            z-index: 1000;
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.5);
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .footer span {
            color: var(--accent-color);
            font-weight: 600;
        }

        /* Leaflet Dark Theme Overrides */
        .leaflet-container {
            background: #121212 !important;
        }

        .leaflet-popup-content-wrapper,
        .leaflet-popup-tip {
            background: #1e1e1e !important;
            color: #fff !important;
            border: 1px solid rgba(255, 255, 255, 0.1) !important;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5) !important;
        }

        .leaflet-popup-content {
            font-family: 'Inter', sans-serif;
            line-height: 1.5;
        }

        .popup-title {
            color: var(--accent-color);
            font-weight: 600;
            margin-bottom: 5px;
            display: block;
        }

        .popup-meta {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.7);
        }
    </style>
</head>

<body>

    <div class="header">
        <h1>JOURNEY TO PHITSANULOK</h1>
    </div>

    <div id="map"></div>

    <div class="info-panel" id="info-panel">
        <div>Total Distance: <span id="dist">Calculating...</span></div>
        <div style="margin-top: 5px;">Points recorded: <span id="count">0</span></div>
    </div>

    <div class="footer">
        CREATED BY <span>SMILE ORACLE</span> | 2026-02-28
    </div>

    <!-- Leaflet.js JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <!-- PapaParse for CSV parsing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>

    <script>
        // Initialize Map
        const map = L.map('map', {
            zoomControl: false,
            attributionControl: false
        }).setView([17.5, 99.5], 7);

        // Add Dark Theme Tiles (CartoDB Dark Matter)
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
            maxZoom: 19
        }).addTo(map);

        // Function to parse and plot CSV
        async function loadTravelData() {
            try {
                const response = await fetch('travel-phitsanulok.csv');
                const csvData = await response.text();

                Papa.parse(csvData, {
                    header: true,
                    dynamicTyping: true,
                    skipEmptyLines: true,
                    complete: function (results) {
                        const points = results.data;
                        const latLons = [];
                        let waypointCount = 0;

                        // Add Markers and build path
                        points.forEach((pt, index) => {
                            if (pt.lat && pt.lon) {
                                const pos = [pt.lat, pt.lon];
                                latLons.push(pos);
                                waypointCount++;

                                // Only create markers for every 10th point or if it has a locality change to keep it clean
                                // But always include start and end
                                if (index === 0 || index === points.length - 1 || index % 15 === 0) {
                                    const marker = L.circleMarker(pos, {
                                        radius: index === 0 || index === points.length - 1 ? 6 : 3,
                                        fillColor: index === 0 || index === points.length - 1 ? '#00ffd0' : '#ff5252',
                                        color: '#fff',
                                        weight: 1,
                                        opacity: 1,
                                        fillOpacity: 0.8
                                    }).addTo(map);

                                    const batteryIcon = pt.battery > 20 ? 'üîã' : 'ü™´';
                                    const popupContent = `
                                        <b class="popup-title">${pt.locality || pt.address || 'GPS Point'}</b>
                                        <div class="popup-meta">
                                            üïí Time: ${pt.updated}<br>
                                            ${batteryIcon} Battery: ${pt.battery}% (${pt.charging})<br>
                                            üìç Lat: ${pt.lat.toFixed(4)}, Lon: ${pt.lon.toFixed(4)}
                                        </div>
                                    `;
                                    marker.bindPopup(popupContent);
                                }
                            }
                        });

                        // Draw Path (Line)
                        if (latLons.length > 0) {
                            const polyline = L.polyline(latLons, {
                                color: '#00e5ff',
                                weight: 2,
                                opacity: 0.6,
                                dashArray: '5, 5'
                            }).addTo(map);

                            // Auto-fit map to the route
                            map.fitBounds(polyline.getBounds(), { padding: [50, 50] });

                            // Update Info Panel
                            document.getElementById('count').innerText = waypointCount;

                            // Estimate distance (simple calculation)
                            let totalDist = 0;
                            for (let i = 1; i < latLons.length; i++) {
                                totalDist += map.distance(latLons[i - 1], latLons[i]);
                            }
                            document.getElementById('dist').innerText = (totalDist / 1000).toFixed(2) + ' km';
                        }
                    }
                });
            } catch (err) {
                console.error("Error loading CSV:", err);
            }
        }

        // Add Zoom Control to bottom-left
        L.control.zoom({ position: 'bottomleft' }).addTo(map);

        // Load data on start
        loadTravelData();
    </script>
</body>

</html>